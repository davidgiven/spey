'\" t
.\" ** The above line should force tbl to be a preprocessor **
.\" Man page for Spey
.\"
.\" Copyright (C) 2004 David Given
.\" You may distribute under the terms of the GNU General Public
.\" License version 2 as specified in the file COPYING that comes with the
.\" Spey distribution.
.\"
.\" $Source$
.\" $State$
.\"
.TH speyctl 8 "10 February 2007" "0.4.0" "SMTP preprocessor"
.SH NAME
speyctl \- an interface to the Spey configuration database

.SH SYNOPSIS
.B speyctl
.RB [\| \-h
or
.BR \-\-help \|]
.RB [\| \-d 
or 
.B \-\-db
.IR database \|]
.I command 
.RI [\| arguments \|.\|.\|.\|]

.SH DESCRIPTION
.B speyctl
allows you to manipulate the spey's configuration, as well as examining and
manipulating the address database.

By default, the database is stored in
.BR /var/lib/spey/spey.db ,
although this can be overridden with the
.B \-d
option. The database is a standard
.B sqlite
file and may be altered manually if desired, although you should be careful not
to confuse Spey.

The configuration may be changed at any time. Spey will reread the
configuration every time a message arrives.


.SH COMMANDS

The following commands are available.

.TP
.B init
Initialise a new database. If the file already exists, the command will fail.

.TP 
.BI set\  key\ value
Set a configuration variable. For the list of available variables, see the
.B spey(8)
man page. If
.I value
is omitted, the key will be deleted.

.TP
.B list
List out all configuration variables.


.TP
.BI trust\  command\ argument
See below.

.TP
.BI recipient\  command\ argument
See below.

.TP
.BI whitelist\  command\ argument
See below.

.TP
.BI blacklist\  command\ argument
These four commands all modify one of spey's control tables. See the sections
TRUSTED HOSTS, ALLOWED RECIPIENTS, and BLACKLISTS AND WHITELISTS in the
.B spey(8)
man page for for more information about these tables.

.I command
should be one of
.BR add ,\  sub \ or\  list .
If
.BR add ,
then the specified key will be added to the table. If
.BR sub ,
then the key will be removed.
.B list
will show the current table.


.TP
.B stats
Display a summary of the number of messages processed so far, and what
categories they fall in to.


.TP
.B showdb
Lists out the current address database. The three columns are: network address
of sender, the number of times this particular address/sender/recipient tuple
has been seen, and the sender/recipient. The list is sorted by the number of
times seen, most recent tuples first.


.TP
.B purge
Discards any stale entries from the database. 'Stale' refers to network
address/sender/recipient tuples that have not been seen for longer than a
certain limit. The limit differs depending whether the tuple has been seen once
(likely spam) or more than once (likely real mail). See the
.B invalid-expiry
and
.B valid-expiry
configuration variables in the
.B spey(8)
manpage for more information.
.B purge
should be run on a regular basis, or Spey's database will grow without limit!


.SH FILES
.TP
.I /var/lib/spey/spey.db
Default database.


.SH "AUTHOR & LICENSE"
Spey and speyctl are (C) 2004 David Given. Comments and criticism to
.BR dg@cowlark.com .
They are distributable under the terms of the GNU General Public License v2. A
full copy can be found in the Spey source distribution, or at
.BR http://www.fsf.org/copyleft/gpl.html .

.\" Revision history
.\" $Log$
.\" Revision 1.11  2007/02/01 18:41:47  dtrg
.\" Reworked the SMTP AUTH code so that spey automatically figures out what
.\" authentication mechanisms there are by asking the downstream server. The
.\" external-auth setting variable is now a boolean. Rearranged various
.\" other bits of code and fixed a lot of problems with the man pages.
.\"
.\" Revision 1.10  2005/11/23 22:43:29  dtrg
.\" Updated for the real 0.3.3 release.
.\"
.\" Revision 1.9  2005/09/30 23:20:17  dtrg
.\" Updated the version number for 0.3.3. Added support for dropping root privileges, by setting the runtime-user-id configuration variable to the desired user and group.
.\"
.\" Revision 1.8  2004/11/21 18:46:49  dtrg
.\" Updated version numbering to 0.3.2.
.\"
.\" Revision 1.7  2004/06/30 21:44:00  dtrg
.\" Updated version number for 0.3.1.
.\"
.\" Revision 1.6  2004/06/22 21:11:29  dtrg
.\" Updated version numbers to 0.3.0.
.\"
.\" Revision 1.5  2004/06/21 23:12:46  dtrg
.\" Added blacklisting and whitelisting support.
.\"
.\" Revision 1.4  2004/05/30 13:43:45  dtrg
.\" Decided to make new version 0.2.9, not 0.3, as there are no actual user-visible
.\" new features. Plus I want a delay for bugfixing.
.\"
.\" Revision 1.3  2004/05/30 01:55:13  dtrg
.\" Numerous and major alterations to implement a system for processing more than
.\" one message at a time, based around coroutines. Fairly hefty rearrangement of
.\" constructors and object ownership semantics. Assorted other structural
.\" modifications.
.\"
.\" Revision 1.2  2004/05/13 23:36:01  dtrg
.\" Rewrote speyctl in awk, a much better scripting language than the Bourne shell.
.\" It now works way better, is much easier to understand, and is probably much
.\" faster. Added the interface to allow modification of the relay table with
.\" speyctl, and wrote all the documentation.
.\"
.\" Revision 1.1  2004/05/01 12:20:20  dtrg
.\" Initial version.

